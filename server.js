const express = require('express');
const cors = require('cors');
const path = require('path');

const app = express();
const PORT = process.env.PORT || 3001;

// Middleware
app.use(cors());
app.use(express.json());

// Данные о тортах
const cakes = [
  {
    id: 'napoleon',
    name: 'Наполеон',
    price: 45,
    image: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    description: 'Классический многослойный торт, который стал символом изысканной кондитерской традиции. Наш Наполеон состоит из тончайших слоев слоеного теста, между которыми находится нежнейший заварной крем с ванилью.',
    fullDescription: 'Наполеон — это классический многослойный торт, который стал символом изысканной кондитерской традиции. Наш Наполеон состоит из тончайших слоев слоеного теста, между которыми находится нежнейший заварной крем с ванилью. Каждый слой пропитывается кремом, создавая неповторимую текстуру и вкус. Мы готовим этот торт по традиционному рецепту, передаваемому из поколения в поколение. Тесто выпекается до золотистого цвета, а крем готовится на основе молока и яиц с добавлением натуральной ванили. Верхний слой посыпается крошкой из теста, что придает торту завершенный вид.',
    recipe: {
      description: 'Для тех, кто хочет попробовать приготовить Наполеон дома, мы делимся нашим рецептом. Обратите внимание, что для достижения идеального результата требуется терпение и аккуратность.',
      ingredients: [
        { name: 'Мука', amount: '500 г', note: 'Высший сорт' },
        { name: 'Сливочное масло', amount: '400 г', note: 'Охлажденное' },
        { name: 'Вода', amount: '200 мл', note: 'Холодная' },
        { name: 'Яйца', amount: '2 шт', note: 'Для теста' },
        { name: 'Молоко', amount: '1 л', note: 'Для крема' },
        { name: 'Яйца', amount: '4 шт', note: 'Для крема' },
        { name: 'Сахар', amount: '300 г', note: 'Для крема' },
        { name: 'Мука', amount: '100 г', note: 'Для крема' },
        { name: 'Ваниль', amount: '1 ч.л.', note: 'Натуральная' },
        { name: 'Сливочное масло', amount: '200 г', note: 'Для крема, размягченное' }
      ],
      instructions: 'Замесите тесто из муки, масла, воды и яиц. Раскатайте в тонкие пласты и выпекайте каждый слой отдельно при температуре 200°C до золотистого цвета. Для крема смешайте молоко, яйца, сахар и муку, варите до загустения, затем добавьте масло и ваниль. Соберите торт, промазывая каждый слой кремом. Дайте настояться в холодильнике не менее 6 часов.'
    }
  },
  {
    id: 'medovik',
    name: 'Медовик',
    price: 42,
    image: 'https://images.unsplash.com/photo-1621303837174-89787a7d4729?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    description: 'Ароматный медовый торт с нежным кремом из сметаны. Каждый слой пропитан медовым сиропом, что делает торт особенно сочным и вкусным.',
    fullDescription: 'Медовик — это ароматный и сочный торт, который покоряет своим медовым вкусом и нежной текстурой. Наш Медовик состоит из тонких медовых коржей, пропитанных нежным кремом на основе сметаны. Каждый кусочек тает во рту, оставляя послевкусие натурального меда. Мы используем только натуральный мед и свежую сметану высшего качества. Коржи выпекаются до золотисто-коричневого цвета и имеют характерный медовый аромат. Крем готовится с добавлением сахарной пудры и ванили, что создает идеальный баланс сладости и нежности.',
    recipe: {
      description: 'Медовик — это торт, который требует внимания к деталям, но результат того стоит. Предлагаем вам попробовать приготовить его по нашему рецепту.',
      ingredients: [
        { name: 'Мед', amount: '200 г', note: 'Натуральный, жидкий' },
        { name: 'Сахар', amount: '150 г', note: 'Для теста' },
        { name: 'Сливочное масло', amount: '100 г', note: 'Размягченное' },
        { name: 'Яйца', amount: '3 шт', note: 'Крупные' },
        { name: 'Мука', amount: '500 г', note: 'Высший сорт' },
        { name: 'Сода', amount: '1 ч.л.', note: 'Погашенная уксусом' },
        { name: 'Сметана', amount: '800 г', note: 'Жирность 20-25%' },
        { name: 'Сахарная пудра', amount: '200 г', note: 'Для крема' },
        { name: 'Ваниль', amount: '1 ч.л.', note: 'Для крема' },
        { name: 'Грецкие орехи', amount: '100 г', note: 'Для украшения' }
      ],
      instructions: 'Растопите мед с сахаром и маслом на водяной бане. Добавьте яйца и соду, перемешайте. Постепенно введите муку и замесите тесто. Разделите на 6-8 частей и раскатайте тонкие коржи. Выпекайте при температуре 180°C до золотистого цвета. Для крема взбейте сметану с сахарной пудрой и ванилью. Соберите торт, промазывая каждый корж кремом. Дайте настояться в холодильнике не менее 8 часов. Перед подачей посыпьте крошкой и орехами.'
    }
  },
  {
    id: 'cheesecake',
    name: 'Чизкейк',
    price: 48,
    image: 'https://images.unsplash.com/photo-1524351199678-941a58a3df50?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80',
    description: 'Нежный сырный торт на основе творожного сыра с ягодным топпингом. Легкий и воздушный, с идеальным балансом сладости и кислотности.',
    fullDescription: 'Чизкейк — это изысканный десерт, который сочетает в себе нежность творожного сыра и сладость ягодного топпинга. Наш Чизкейк готовится на основе печенья с добавлением сливочного масла для основы и нежного крема из творожного сыра, сливок и сахара. Мы используем только качественный творожный сыр и свежие ягоды для топпинга. Торт запекается при низкой температуре, что позволяет сохранить нежную текстуру и избежать трещин. Верхний слой украшается свежими ягодами и ягодным соусом, что придает торту яркий и аппетитный вид.',
    recipe: {
      description: 'Чизкейк требует точности в приготовлении, но результат превосходит все ожидания. Попробуйте приготовить его по нашему рецепту.',
      ingredients: [
        { name: 'Печенье', amount: '300 г', note: 'Песочное, измельченное' },
        { name: 'Сливочное масло', amount: '100 г', note: 'Растопленное' },
        { name: 'Творожный сыр', amount: '600 г', note: 'Комнатной температуры' },
        { name: 'Сахар', amount: '200 г', note: 'Для крема' },
        { name: 'Яйца', amount: '3 шт', note: 'Комнатной температуры' },
        { name: 'Сливки', amount: '200 мл', note: 'Жирность 33%' },
        { name: 'Ваниль', amount: '1 ч.л.', note: 'Экстракт' },
        { name: 'Ягоды', amount: '300 г', note: 'Клубника, малина, черника' },
        { name: 'Сахар', amount: '50 г', note: 'Для топпинга' },
        { name: 'Лимонный сок', amount: '1 ст.л.', note: 'Свежевыжатый' }
      ],
      instructions: 'Смешайте измельченное печенье с растопленным маслом и утрамбуйте в форму с высокими бортами. Выпекайте основу 10 минут при 180°C. Для крема взбейте творожный сыр с сахаром, добавьте яйца по одному, затем сливки и ваниль. Вылейте крем на основу и запекайте при 160°C в течение 50-60 минут. Остудите в духовке с приоткрытой дверцей, затем уберите в холодильник на 6 часов. Для топпинга проварите ягоды с сахаром и лимонным соком до загустения. Подавайте чизкейк с ягодным топпингом.'
    }
  }
];

// Роут для получения всех тортов
app.get('/cakes', (req, res) => {
  res.json(cakes);
});

// Роут для получения конкретного торта по ID
app.get('/cakes/:id', (req, res) => {
  console.log('Запрос на получение торта с ID:', req.params.id);
  const cake = cakes.find(c => c.id === req.params.id);
  if (!cake) {
    console.log('Торт не найден:', req.params.id);
    return res.status(404).json({ error: 'Торт не найден' });
  }
  console.log('Торт найден:', cake.name);
  res.json(cake);
});

app.listen(PORT, () => {
  console.log(`Сервер запущен на порту ${PORT}`);
  console.log(`API доступно по адресу: http://localhost:${PORT}/cakes`);
});
